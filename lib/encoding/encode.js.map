{"version":3,"file":"encode.js","sourceRoot":"","sources":["../../src/encoding/encode.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-nocheck\r\n\r\n/**\r\n * Copyright (c) 2018 Endel Dreyer\r\n * Copyright (c) 2014 Ion Drive Software Ltd.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE\r\n */\r\n\r\nimport type { TextEncoder } from \"util\";\r\nimport type { Iterator } from \"./decode\";\r\n\r\nexport type BufferLike = number[] | ArrayBufferLike | Buffer;\r\n\r\n/**\r\n * msgpack implementation highly based on notepack.io\r\n * https://github.com/darrachequesne/notepack\r\n */\r\n\r\nlet textEncoder: TextEncoder;\r\n// @ts-ignore\r\ntry { textEncoder = new TextEncoder(); } catch (e) { }\r\n\r\n// force little endian to facilitate decoding on multiple implementations\r\nconst _isLittleEndian = true;  // new Uint16Array(new Uint8Array([1, 0]).buffer)[0] === 1;\r\nconst _convoBuffer = new ArrayBuffer(8);\r\nconst _int32 = new Int32Array(_convoBuffer);\r\nconst _float32 = new Float32Array(_convoBuffer);\r\nconst _float64 = new Float64Array(_convoBuffer);\r\nconst _int64 = new BigInt64Array(_convoBuffer);\r\n\r\nconst hasBufferByteLength = (typeof Buffer !== 'undefined' && Buffer.byteLength);\r\n\r\nconst utf8Length: (str: string, _?: any) => number = (hasBufferByteLength)\r\n    ? Buffer.byteLength // node\r\n    : function (str: string, _?: any) {\r\n        var c = 0, length = 0;\r\n        for (var i = 0, l = str.length; i < l; i++) {\r\n            c = str.charCodeAt(i);\r\n            if (c < 0x80) {\r\n                length += 1;\r\n            }\r\n            else if (c < 0x800) {\r\n                length += 2;\r\n            }\r\n            else if (c < 0xd800 || c >= 0xe000) {\r\n                length += 3;\r\n            }\r\n            else {\r\n                i++;\r\n                length += 4;\r\n            }\r\n        }\r\n        return length;\r\n    }\r\n\r\nfunction utf8Write(view: BufferLike, str: string, it: Iterator) {\r\n  var c = 0;\r\n  for (var i = 0, l = str.length; i < l; i++) {\r\n    c = str.charCodeAt(i);\r\n    if (c < 0x80) {\r\n      view[it.offset++] = c;\r\n    }\r\n    else if (c < 0x800) {\r\n      view[it.offset] = 0xc0 | (c >> 6);\r\n      view[it.offset + 1] = 0x80 | (c & 0x3f);\r\n      it.offset += 2;\r\n    }\r\n    else if (c < 0xd800 || c >= 0xe000) {\r\n      view[it.offset] = 0xe0 | (c >> 12);\r\n      view[it.offset+1] = 0x80 | (c >> 6 & 0x3f);\r\n      view[it.offset+2] = 0x80 | (c & 0x3f);\r\n      it.offset += 3;\r\n    }\r\n    else {\r\n      i++;\r\n      c = 0x10000 + (((c & 0x3ff) << 10) | (str.charCodeAt(i) & 0x3ff));\r\n      view[it.offset] = 0xf0 | (c >> 18);\r\n      view[it.offset+1] = 0x80 | (c >> 12 & 0x3f);\r\n      view[it.offset+2] = 0x80 | (c >> 6 & 0x3f);\r\n      view[it.offset+3] = 0x80 | (c & 0x3f);\r\n      it.offset += 4;\r\n    }\r\n  }\r\n}\r\n\r\nfunction int8(bytes: BufferLike, value: number, it: Iterator) {\r\n    bytes[it.offset++] = value & 255;\r\n};\r\n\r\nfunction uint8(bytes: BufferLike, value: number, it: Iterator) {\r\n    bytes[it.offset++] = value & 255;\r\n};\r\n\r\nfunction int16(bytes: BufferLike, value: number, it: Iterator) {\r\n    bytes[it.offset++] = value & 255;\r\n    bytes[it.offset++] = (value >> 8) & 255;\r\n};\r\n\r\nfunction uint16(bytes: BufferLike, value: number, it: Iterator) {\r\n    bytes[it.offset++] = value & 255;\r\n    bytes[it.offset++] = (value >> 8) & 255;\r\n};\r\n\r\nfunction int32(bytes: BufferLike, value: number, it: Iterator) {\r\n  bytes[it.offset++] = value & 255;\r\n  bytes[it.offset++] = (value >> 8) & 255;\r\n  bytes[it.offset++] = (value >> 16) & 255;\r\n  bytes[it.offset++] = (value >> 24) & 255;\r\n};\r\n\r\nfunction uint32(bytes: BufferLike, value: number, it: Iterator) {\r\n  const b4 = value >> 24;\r\n  const b3 = value >> 16;\r\n  const b2 = value >> 8;\r\n  const b1 = value;\r\n  bytes[it.offset++] = b1 & 255;\r\n  bytes[it.offset++] = b2 & 255;\r\n  bytes[it.offset++] = b3 & 255;\r\n  bytes[it.offset++] = b4 & 255;\r\n};\r\n\r\nfunction int64(bytes: BufferLike, value: number, it: Iterator) {\r\n  const high = Math.floor(value / Math.pow(2, 32));\r\n  const low = value >>> 0;\r\n  uint32(bytes, low, it);\r\n  uint32(bytes, high, it);\r\n};\r\n\r\nfunction uint64(bytes: BufferLike, value: number, it: Iterator) {\r\n  const high = (value / Math.pow(2, 32)) >> 0;\r\n  const low = value >>> 0;\r\n  uint32(bytes, low, it);\r\n  uint32(bytes, high, it);\r\n};\r\n\r\nfunction bigint64(bytes: BufferLike, value: bigint, it: Iterator) {\r\n    _int64[0] = BigInt.asIntN(64, value);\r\n    int32(bytes, _int32[0], it);\r\n    int32(bytes, _int32[1], it);\r\n}\r\n\r\nfunction biguint64(bytes: BufferLike, value: bigint, it: Iterator) {\r\n    _int64[0] = BigInt.asIntN(64, value);\r\n    int32(bytes, _int32[0], it);\r\n    int32(bytes, _int32[1], it);\r\n}\r\n\r\nfunction float32(bytes: BufferLike, value: number, it: Iterator) {\r\n  _float32[0] = value;\r\n  int32(bytes, _int32[0], it);\r\n}\r\n\r\nfunction float64(bytes: BufferLike, value: number, it: Iterator) {\r\n  _float64[0] = value;\r\n  int32(bytes, _int32[_isLittleEndian ? 0 : 1], it);\r\n  int32(bytes, _int32[_isLittleEndian ? 1 : 0], it);\r\n}\r\n\r\nfunction boolean(bytes: BufferLike, value: number, it: Iterator) {\r\n  bytes[it.offset++] = value ? 1 : 0; // uint8\r\n};\r\n\r\nfunction string(bytes: BufferLike, value: string, it: Iterator) {\r\n  // encode `null` strings as empty.\r\n  if (!value) { value = \"\"; }\r\n\r\n  let length = utf8Length(value, \"utf8\");\r\n  let size = 0;\r\n\r\n  // fixstr\r\n  if (length < 0x20) {\r\n    bytes[it.offset++] = length | 0xa0;\r\n    size = 1;\r\n  }\r\n  // str 8\r\n  else if (length < 0x100) {\r\n    bytes[it.offset++] = 0xd9;\r\n    bytes[it.offset++] = length % 255;\r\n    size = 2;\r\n  }\r\n  // str 16\r\n  else if (length < 0x10000) {\r\n    bytes[it.offset++] = 0xda;\r\n    uint16(bytes, length, it);\r\n    size = 3;\r\n  }\r\n  // str 32\r\n  else if (length < 0x100000000) {\r\n    bytes[it.offset++] = 0xdb;\r\n    uint32(bytes, length, it);\r\n    size = 5;\r\n  } else {\r\n    throw new Error('String too long');\r\n  }\r\n\r\n  utf8Write(bytes, value, it);\r\n\r\n  return size + length;\r\n}\r\n\r\nfunction number(bytes: BufferLike, value: number, it: Iterator) {\r\n  if (isNaN(value)) {\r\n    return number(bytes, 0, it);\r\n\r\n  } else if (!isFinite(value)) {\r\n    return number(bytes, (value > 0) ? Number.MAX_SAFE_INTEGER : -Number.MAX_SAFE_INTEGER, it);\r\n\r\n  } else if (value !== (value|0)) {\r\n    if (Math.abs(value) <= 3.4028235e+38) { // range check\r\n        _float32[0] = value;\r\n        if (Math.abs(Math.abs(_float32[0]) - Math.abs(value)) < 1e-4) { // precision check; adjust 1e-n (n = precision) to in-/decrease acceptable precision loss\r\n            // now we know value is in range for f32 and has acceptable precision for f32\r\n            bytes[it.offset++] = 0xca;\r\n            float32(bytes, value, it);\r\n            return 5;\r\n        }\r\n    }\r\n\r\n    bytes[it.offset++] = 0xcb;\r\n    float64(bytes, value, it);\r\n    return 9;\r\n  }\r\n\r\n  if (value >= 0) {\r\n    // positive fixnum\r\n    if (value < 0x80) {\r\n      bytes[it.offset++] = value & 255; // uint8\r\n      return 1;\r\n    }\r\n\r\n    // uint 8\r\n    if (value < 0x100) {\r\n      bytes[it.offset++] = 0xcc;\r\n      bytes[it.offset++] = value & 255; // uint8\r\n      return 2;\r\n    }\r\n\r\n    // uint 16\r\n    if (value < 0x10000) {\r\n      bytes[it.offset++] = 0xcd;\r\n      uint16(bytes, value, it);\r\n      return 3;\r\n    }\r\n\r\n    // uint 32\r\n    if (value < 0x100000000) {\r\n      bytes[it.offset++] = 0xce;\r\n      uint32(bytes, value, it);\r\n      return 5;\r\n    }\r\n\r\n    // uint 64\r\n    bytes[it.offset++] = 0xcf;\r\n    uint64(bytes, value, it);\r\n    return 9;\r\n\r\n  } else {\r\n\r\n    // negative fixnum\r\n    if (value >= -0x20) {\r\n      bytes[it.offset++] = 0xe0 | (value + 0x20);\r\n      return 1;\r\n    }\r\n\r\n    // int 8\r\n    if (value >= -0x80) {\r\n      bytes[it.offset++] = 0xd0;\r\n      int8(bytes, value, it);\r\n      return 2;\r\n    }\r\n\r\n    // int 16\r\n    if (value >= -0x8000) {\r\n      bytes[it.offset++] = 0xd1;\r\n      int16(bytes, value, it);\r\n      return 3;\r\n    }\r\n\r\n    // int 32\r\n    if (value >= -0x80000000) {\r\n      bytes[it.offset++] = 0xd2;\r\n      int32(bytes, value, it);\r\n      return 5;\r\n    }\r\n\r\n    // int 64\r\n    bytes[it.offset++] = 0xd3;\r\n    int64(bytes, value, it);\r\n    return 9;\r\n  }\r\n}\r\n\r\nexport const encode = {\r\n    int8,\r\n    uint8,\r\n    int16,\r\n    uint16,\r\n    int32,\r\n    uint32,\r\n    int64,\r\n    uint64,\r\n    bigint64,\r\n    biguint64,\r\n    float32,\r\n    float64,\r\n    boolean,\r\n    string,\r\n    number,\r\n    utf8Write,\r\n    utf8Length,\r\n}"]}