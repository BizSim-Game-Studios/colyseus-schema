{"version":3,"file":"v3_bench.js","sourceRoot":"","sources":["../src/v3_bench.ts"],"names":[],"mappings":"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","sourcesContent":["import { Schema, type, MapSchema, ArraySchema, Reflection, Encoder, Decoder } from \"./index\";\r\n\r\n// globalThis.interval = setInterval(() => {}, 1000);\r\n\r\n// class Item extends Schema {\r\n//     @type(\"string\") name: string;\r\n// }\r\n\r\n// class RootState extends Schema {\r\n//     @type([Item]) items = new ArraySchema<Item>();\r\n// }\r\n// const state = new RootState();\r\n// state.items.push(new Item().assign({ name: \"hello\" }));\r\n\r\n// console.log(\"Encoded:\", state.encode());\r\n\r\nclass Vec3 extends Schema {\r\n    @type(\"number\") x: number;\r\n    @type(\"number\") y: number;\r\n    @type(\"number\") z: number;\r\n}\r\n\r\nclass Base extends Schema {}\r\n\r\nclass Entity extends Schema {\r\n    @type(Vec3) position = new Vec3().assign({ x: 0, y: 0, z: 0 });\r\n}\r\n\r\nclass Player extends Entity {\r\n    @type(Vec3) rotation = new Vec3().assign({ x: 0, y: 0, z: 0 });\r\n    @type(\"string\") secret: string = \"private info only for this player\";\r\n}\r\n\r\nclass State extends Schema {\r\n    // @type({ map: Base }) players = new MapSchema<Entity>();\r\n    @type(\"number\") num: number = 0;\r\n    @type(\"string\") str = \"Hello world!\";\r\n    // @type(Entity) entity = new Player().assign({\r\n    //     position: new Vec3().assign({ x: 1, y: 2, z: 3 }),\r\n    //     rotation: new Vec3().assign({ x: 4, y: 5, z: 6 }),\r\n    // });\r\n    @type({ map: Entity }) entities = new MapSchema();\r\n}\r\n\r\nconst state = new State();\r\n\r\nstate.entities.set(\"one\", new Player().assign({\r\n  position: new Vec3().assign({ x: 1, y: 2, z: 3 }),\r\n  rotation: new Vec3().assign({ x: 1, y: 2, z: 3 }),\r\n}));\r\n\r\nstate.entities.set(\"two\", new Player().assign({\r\n  position: new Vec3().assign({ x: 4, y: 5, z: 6 }),\r\n  rotation: new Vec3().assign({ x: 7, y: 8, z: 9 }),\r\n}));\r\n\r\nconst encoder = new Encoder(state);\r\nlet encoded = encoder.encode();\r\nconsole.log(`(${encoded.length})`, [...encoded]);\r\n\r\n(globalThis as any).perform = function(): void {\r\n    for (let i = 0; i < 500000; i++) {\r\n        encoder.encodeAll();\r\n    }\r\n}\r\n\r\nfunction logTime(label: string, callback: Function) {\r\n    const time = Date.now();\r\n    for (let i = 0; i < 500000; i++) {\r\n        callback();\r\n    }\r\n    console.log(`${label}:`, Date.now() - time);\r\n}\r\nlogTime(\"encode time\", () => encoder.encodeAll());\r\n\r\nconst decoder = new Decoder(new State());\r\nlogTime(\"decode time\", () => decoder.decode(encoded));\r\n\r\n// const time = Date.now();\r\n// console.profile();\r\n// for (let i = 0; i < 300000; i++) {\r\n//   state.encodeAll();\r\n// }\r\n// console.profileEnd();\r\n// console.log(\"encode time:\", Date.now() - time);\r\n\r\n// const decoded = Reflection.decode(Reflection.encode(state));\r\n// decoded.decode(encoded);\r\n//\r\n// console.log(decoded.toJSON());\r\n//\r\n// const rotation = state.entity.rotation;\r\n// rotation.x = 100;\r\n//\r\n// encoded = state.encode();\r\n// console.log({encoded});\r\n//\r\n// decoded.decode(encoded);\r\n// console.log(decoded.toJSON());\r\n\r\n// const time = Date.now();\r\n// for (let i = 0; i < 300000; i++) {\r\n//   const state = new State();\r\n//   state.encode();\r\n// }\r\n// console.log(\"encode time:\", Date.now() - time);\r\n\r\n"]}